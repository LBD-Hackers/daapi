{"version":3,"file":"functions.js","names":["N3","require","DataFactory","namedNode","literal","defaultGraph","quad","variable","translate","toSparql","generateSession","options","webId","email","password","name","idp","endsWith","response","fetch","method","headers","body","JSON","stringify","id","secret","json","tokenUrl","authString","encodeURIComponent","dpopKey","generateDpopKeyPair","r","authorization","Buffer","from","toString","dpop","createDpopHeader","access_token","authFetch","buildAuthenticatedFetch","info","isLoggedIn","error","console","log","getRoot","resource","root","split","slice","length","join","getSatelliteFromLdpResource","engine","QueryEngine","query","bindingsStream","queryBindings","sources","bindings","toArray","get","value","Error","extract","jsonld","uri","Object","assign","filter","i","prefixes","inference","myEngine","registries","store","Promise","resolve","reject","start","Date","q","quadStream","queryQuads","on","res","subject","predicate","object","addQuad","err","duration","getTime","streamToString","stream","chunks","chunk","push","concat","asStream","variables","mutateQuery","s","result","data","resultToString","parse","findLowerLevel","obj","type","bgp","input","translation","usedVariables","Set","aliasNumber","aliases","pattern","patterns","item","keys","termType","has","newVName","newV","add","forEach","alias","newPattern","Array"],"sources":["../../../src/helpers/functions.ts"],"sourcesContent":["import fetch from 'cross-fetch';\r\nimport { createDpopHeader, generateDpopKeyPair, buildAuthenticatedFetch, getWebidFromTokenPayload} from '@inrupt/solid-client-authn-core';\r\nimport {v4} from 'uuid' \r\nimport { TokenSession } from './interfaces';\r\nimport { QueryEngine } from '@comunica/query-sparql';\r\n\r\nconst N3 = require('n3');\r\nconst { DataFactory } = N3;\r\nconst { namedNode, literal, defaultGraph, quad, variable } = DataFactory;\r\nconst {translate, toSparql} = require(\"sparqlalgebrajs\")\r\n\r\n\r\nexport async function generateSession(options: any, webId: string): Promise<TokenSession> {\r\n  try {\r\n      let {email, password, name, idp} = options\r\n      if (!idp.endsWith(\"/\")) idp += '/'\r\n      const response = await fetch(`${idp}idp/credentials/`, {\r\n          method: 'POST',\r\n          headers: { 'content-type': 'application/json' },\r\n          body: JSON.stringify({ email, password, name }),\r\n      });\r\n  \r\n      const {id, secret}= await response.json();\r\n      const tokenUrl = `${idp}.oidc/token`;\r\n      const authString = `${encodeURIComponent(id)}:${encodeURIComponent(secret)}`;\r\n      const dpopKey = await generateDpopKeyPair();\r\n      const r = await fetch(tokenUrl, {\r\n          method: 'POST',\r\n          headers: {\r\n              // The header needs to be in base64 encoding.\r\n              authorization: `Basic ${Buffer.from(authString).toString('base64')}`,\r\n              'content-type': 'application/x-www-form-urlencoded',\r\n              dpop: await createDpopHeader(tokenUrl, 'POST', dpopKey),\r\n          },\r\n          body: 'grant_type=client_credentials&scope=webid',\r\n      });\r\n      const {access_token} = await r.json();\r\n      \r\n      const authFetch = await buildAuthenticatedFetch(fetch, access_token, { dpopKey });\r\n\r\n      return {fetch: authFetch, info: {webId, isLoggedIn: true}}\r\n\r\n  } catch (error) {\r\n      console.log('error', error)\r\n      throw error\r\n  }\r\n}\r\n\r\nexport function getRoot(resource) {\r\n  let root = resource.split('/').slice(0, resource.split('/').length -1);\r\n  root = root.join('/')\r\n  console.log('root', root)\r\n  if (!root.endsWith('/')) root += '/'\r\n  return root\r\n}\r\n\r\nexport async function getSatelliteFromLdpResource(resource: string, engine?: QueryEngine) {\r\n  if (!engine) {\r\n    engine = new QueryEngine()\r\n  }\r\n\r\n  // find webId of resource\r\n  let root = getRoot(resource)\r\n  const webId = root + \"profile/card#me\";\r\n  const query = `\r\n  SELECT ?satellite WHERE {\r\n    <${webId}> <https://w3id.org/consolid#hasSparqlSatellite> ?satellite .\r\n  } LIMIT 1`\r\n\r\n  const bindingsStream = await engine.queryBindings(query, {sources: [webId]});\r\n  const bindings = await bindingsStream.toArray()\r\n  if (bindings.length) return bindings[0].get('satellite').value\r\n  else throw Error(`Could not find SPARQL satellite at WebId \"${webId}\"`)\r\n}\r\n\r\nfunction extract(jsonld: object[], uri: string) {\r\n  return Object.assign({}, ...jsonld.filter((i) => i[\"@id\"] === uri));\r\n}\r\n\r\nconst prefixes = `\r\nprefix owl: <http://www.w3.org/2002/07/owl#> \r\nprefix beo: <http://pi.pauwel.be/voc/buildingelement#>\r\nprefix props: <http://example.org/props#> \r\nprefix consolid: <https://w3id.org/consolid#>\r\nprefix schema: <http://schema.org/>\r\n`\r\n\r\nfunction inference(myEngine, { registries, fetch, store }): Promise<void> {\r\n  return new Promise(async (resolve, reject) => {\r\n    const start = new Date()\r\n      const q = prefixes + `\r\n      CONSTRUCT {\r\n       ?s1 owl:sameAs ?s2 .\r\n       ?s2 owl:sameAs ?s1 .\r\n      } WHERE {\r\n          {?concept1 lbds:hasReference/lbds:hasIdentifier/<https://w3id.org/consolid#value> ?s1 .\r\n          ?concept2 lbds:hasReference/lbds:hasIdentifier/<https://w3id.org/consolid#value> ?s2 .\r\n          ?concept1 owl:sameAs ?concept2 .} UNION {\r\n            ?concept1 lbds:hasReference/lbds:hasIdentifier/<https://w3id.org/consolid#value> ?s1, ?s2 .\r\n          }\r\n          FILTER(isIRI(?s1) && isIRI(?s2))\r\n          FILTER(?s1 != ?s2)\r\n      }`\r\n      const quadStream = await myEngine.queryQuads(q, {\r\n          sources: registries,\r\n          fetch\r\n      });\r\n\r\n      quadStream.on('data', (res) => {\r\n        // console.log('res.subject, res.object.id', res.subject.id, res.object.id)\r\n            const q = quad(\r\n                namedNode(res.subject.id),\r\n                namedNode(res.predicate.value),\r\n                namedNode(res.object.id),\r\n                defaultGraph()\r\n            )\r\n            store.addQuad(q)\r\n          \r\n\r\n      });\r\n\r\n      quadStream.on('error', (err) => {\r\n        reject(err)\r\n    });\r\n\r\n      quadStream.on('end', () => {\r\n        const duration = new Date().getTime() - start.getTime()\r\n        console.log('duration inference', duration)\r\n          resolve()\r\n      })\r\n  })\r\n}\r\n\r\nfunction streamToString (stream): Promise<string> {\r\n  const chunks = [];\r\n  return new Promise((resolve, reject) => {\r\n    stream.on('data', (chunk) => chunks.push(Buffer.from(chunk)));\r\n    stream.on('error', (err) => reject(err));\r\n    stream.on('end', () => resolve(Buffer.concat(chunks).toString('utf8')));\r\n  })\r\n}\r\n\r\nasync function query(q, options) {\r\n      let { sources, fetch, store, registries, asStream} = options\r\n      const {query, variables } = await mutateQuery(q)\r\n\r\n      // const newQ = prefixes + \"Select * where {?s1 owl:sameAs ?s2} \"\r\n      const myEngine = new QueryEngine();\r\n      // if (!store) store = new N3.Store();\r\n      const s: any =  [...sources, ...registries]\r\n      // await inference(myEngine, { registries, fetch, store })\r\n      const result = await myEngine.query(query, { sources: s, fetch })\r\n      const { data } = await myEngine.resultToString(result,\r\n          'application/sparql-results+json');\r\n      if (asStream) {\r\n          return data\r\n      } else {\r\n          return JSON.parse(await streamToString(data))\r\n      }\r\n}\r\n\r\nfunction findLowerLevel(obj, variables) {\r\n  if (!variables) variables = obj.variables\r\n  if (obj.type === \"bgp\") {\r\n      return {bgp: obj, variables}\r\n  } else {\r\n      return findLowerLevel(obj.input, variables)\r\n  }\r\n}\r\n\r\nasync function mutateQuery(query) {\r\n  const translation = translate(query);\r\n  const {bgp, variables} = findLowerLevel(translation, translation.variables)\r\n  const usedVariables = new Set()\r\n  let aliasNumber = 1\r\n  let aliases = {}\r\n  for (const pattern of bgp.patterns) {\r\n      for (const item of Object.keys(pattern)) {\r\n       if (pattern[item].termType === \"Variable\") {\r\n          if (usedVariables.has(pattern[item])) {\r\n              const newVName = `${pattern[item].value}_alias${aliasNumber}`\r\n              if (!aliases[pattern[item].value]) aliases[pattern[item].value] = []\r\n\r\n              aliases[pattern[item].value].push(newVName)\r\n              aliasNumber += 1\r\n              const newV = {termType: \"Variable\", value: newVName}\r\n              pattern[item] = newV\r\n          }\r\n          usedVariables.add(pattern[item])\r\n       }\r\n         \r\n      }\r\n  }\r\n  Object.keys(aliases).forEach(item => {\r\n      aliases[item].forEach(alias => {\r\n          const newPattern = quad(\r\n              variable(item),\r\n              namedNode(\"http://www.w3.org/2002/07/owl#sameAs\"),\r\n              variable(alias),\r\n              defaultGraph()\r\n          )\r\n          bgp.patterns.push(newPattern)\r\n      })\r\n  })\r\n  const q = {type: \"project\", input: {type: \"bgp\", patterns: bgp.patterns}, variables: Array.from(usedVariables)}\r\n  return {query: toSparql(q), variables: Array.from(usedVariables)}\r\n}\r\n\r\nexport { extract, streamToString, query };\r\n"],"mappings":"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"}